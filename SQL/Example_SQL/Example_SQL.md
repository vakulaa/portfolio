**ЗАДАНИЕ И ПОЛУЧЕННЫЕ РЕЗУЛЬТАТЫ ЕГО ВЫПОЛНЕНИЯ (ПО ПУНКТАМ)**

**ЗАДАНИЕ**

Выполните проектирование базы данных:

– анализ предметной области в соответствии с вариантом индивидуального задания;

– выявление сущностей предметной области (не менее 5) и их атрибутов (минимально необходимый перечень атрибутов приведен и может быть расширен);

– определение ключевых атрибутов сущностей; определение связей между сущностями.

Исходные данные в соответствии с вариантом задания находятся в Приложении 1.

Для проектирования реляционной модели можно использовать следующее ПО: AllFusion ERwin Data Modeler (Erwin), SQL Manager Studio, MS Visio, сервис http://ondras.zarovi.cz/sql/demo/.

**Вариант 13. БД Прокат автомобилей**

Компания предоставляет прокат автомобилей. В пункт проката обращаются клиенты, данные которых регистрируют в базе. Цена проката зависит от марки автомобиля, технических характеристик и года выпуска. За каждый час просрочки возврата автомобиля начисляется штраф. При каждом обращении фиксируется дата выдачи автомобиля и дата возврата, номер.

Если клиент не вернул автомобиль в срок и не оформил продление, ему назначается штраф и автомобиль больше не выдается. Постоянным клиентам предоставляются скидки.

БД должна содержать следующий минимальный набор сведений:

– ФИО.

9

– Паспортные данные. 

– Код должности.

– Наименование должности. 

– Оклад.

– Обязанности. 

– Код марки.

– Наименование,

– Технические характеристики, 

– Описание.

– Код автомобиля. 

– Регистрационный номер. 

– Номер кузова.

– Номер двигателя. 

– Год выпуска.

– Пробег,

– Цена автомобиля. 

– Цена проката.

– Дата последнего ТО.

– Код сотрудника-механика. 

– Специальные отметки.

– Отметка о возврате. 

– Код клиента.

– ФИО.

– Адрес. 

– Телефон.

– Паспортные данные.

– Дата и время выдачи автомобиля. 

– На сколько часов.

– Дата и время возврата автомобиля.

**ВЫПОЛНЕНИЯ ЗАДАНИЯ**

**Описание предметной области**

Выделим объекты предметной области:

**Компания** может быть описана с помощью следующих характеристик: унитарный номер плательщика, почтовый индекс, улица, город, дом, номер телефона.

В штат входят работники, называемые агентами. **Агенты** занимаются заключением договоров аренды (проката) автомобилей без экипажа. Информация, описывающая каждого сотрудника компании, включает персональный номер, фамилию, имя, отчество (при его наличии), дату рождения, паспортные данные (идентификационный номер, дата выдачи, срок действия, серия, номер, код органа, выдавшего паспорт, название органа, выдавшего паспорт), пол, адрес проживания, номер телефона, занимаемую должность. Личный номер каждого работника является уникальным в компании.

Данные обо всех предлагаемых для аренды **автомобилях** можно получить в компании. Информация, описывающая каждый **автомобиль**, включает код марки, наименование, технические характеристики (тип двигателя, объем двигателя, средний расход топлива на 100 километров, тип коробки передач), описание, код автомобиля, регистрационный номер, номер кузова, номер двигателя, год выпуска, пробег, цену автомобиля, цену проката, дату последнего ТО. Все автомобили, предназначенные для аренды, принадлежат компании.

Потенциальный **клиент** (**арендатор**) обращается в **компанию**, где ему могут предлагают перечень доступных к аренде автомобилей. О каждом клиенте хранится следующая информация: фамилия, имя, отчество (при наличии), паспортные данные (идентификационный номер, дата выдачи, срок действия, серия, номер, код органа, выдавшего паспорт, название органа, выдавшего паспорт), адрес места жительства, номер телефона, информация о статусе клиента, информация о наличии ранее штрафа за аренду автомобиля компании. Каждый клиент получает личный номер, уникальный для всех пунктов проката компании. 

При аренде автомобиля клиент (арендатор) заключает с компанией **договор аренды** транспортного средства без экипажа. Подробная информация о данном договоре аренды включает: номер договора, дату заключения договора, личный номер клиента (арендатор), его имя и адрес, регистрационный номер автомобиля, сцена проката, а также сведения о сотруднике, который составил данный договор. Клиент может арендовать как один, так и сразу несколько автомобилей.

После заключения договора, перед передачей автомобиля клиенту (арендатору), а также перед возвратом автомобиля в компанию (арендодателю) проводятся осмотры автомобиля, которые оформляется при передаче и возврате автомобиля **актом приема-передачи**.  Подробная информация, содержащаяся в акте приема-передачи по каждому проведённому осмотру и передаче (возврату) автомобиля, включает: номер акта, дату подписания, цену проката, код сотрудника, специальные отметки, отметка о возврате, код клиента, дату выдачи, время выдачи, дату возврата, время возврата, количество часов аренды, количество часов просрочки, размер штрафа.

*Необходимо предусмотреть следующие ограничения на информацию в системе:*

1\. В компании работает, по крайней мере, 1 сотрудник, а максимальное количество сотрудников не ограничено.

2\. Каждый сотрудник может отвечать за аренду не более 10 автомобилей одновременно.

3\. Компания требует сохранять данные об уволившемся сотруднике в течение года.

4\. Каждый клиент при заключении договора аренды автомобиля должен оставить свой номер телефона (рабочий или домашний) для быстрой с ним связи.

5\. Клиент при заключении договора может одновременно арендовать один или более автомобилей. 

В данной информационной системе должны реализовываться определённые задачи, за выполнение которых несут ответственность сотрудники компании. А именно:

создание и корректировка записей с данными о сотрудниках компании;

создание отчёта со сведениями о сотрудниках компании;

удаление сведений об уволившемся сотруднике из базы данных;

создание и корректировка записей с данными о предлагаемых для аренды автомобилях в компании;

создание отчёта с данными обо всех предлагаемых для аренды автомобилях в компании;

создание отчёта с данными обо всех арендуемых клиентами автомобилях компании;

создание отчёта с данными о свободных (доступных) для аренды автомобилях (не арендуемых в настоящий момент) в компании;

создание и корректировка записей с описанием клиентов;

поиск всех автомобилей в компании, удовлетворяющих требованиям клиента;

создание и корректировка записей со сведениями о заключённых договорах;

создание и корректировка записей со сведениями об осмотре и передаче автомобилей;

распечатка договора;

распечатка акта приема-передачи;

при заключении договора аренды с клиентом автомобиль должен автоматически удаляться из списка автомобилей, доступных для аренды.



**Описание сущностей и типов связей**

*Определим основные типы сущностей исходя из описания предметной области.*

**1. Компания (COMPANY)**

Компания имеет следующий набор атрибутов: учетный номер плательщика (УНП), адрес (почтовый индекс, город, улица, дом), номер телефона и номер факса.

**2. Сотрудник (STAFF**)

Каждый сотрудник характеризуется следующими атрибутами: персональный номер, фамилию, имя, отчество (при его наличии), дату рождения, пол, адрес проживания адрес (город, улица, дом, квартира), номер телефона, занимаемую должность, дата зачисления в штат, зарплата, а также номер и адрес пункта проката компании, в котором он работает.

**3. Автомобиль (AUTO)**

Характеризуется такими атрибутами как: код авто, код марки, наименование, технические характеристики (тип двигателя, объем двигателя, средний расход топлива на 100 километров, тип коробки передач), описание, код автомобиля, регистрационный номер, номер кузова, номер двигателя, год выпуска, пробег, цена автомобиля, цена проката, дата последнего ТО.

**4. Клиент (CUSTOMER)** 

Каждый покупатель характеризуется следующими атрибутами: номер клиента, фамилия, имя, отчество (при наличии), адрес (город, улица, дом, квартира), номер телефона (рабочий и (или) домашний), паспортные данные, информация о статусе постоянного клиента, информация о наличии ранее штрафа за аренду автомобиля компании.

**5. Договор аренды (RENTAL\_CONTRACT)**

Каждый договор аренды характеризуется следующими атрибутами: номер договора, дата заключения договора, предмет договора, цена проката.

**6. Акт приема-передачи (ACCEPTANCE\_CERTIFICATE)**

Характеризуется такими атрибутами как: номер акта, дата подписания акта, код сотрудника-механика, специальные отметки, отметка о возрасте, код клиента, дата выдачи, время выдачи, дата возврата, время возврата, количество часов аренды, количество часов просрочки, размер штрафа

*Определим типы связей, которые существуют между основными сущностями.*

**1. Компания и Сотрудник**

Между сущностями **Компания (COMPANY)** и **Сотрудник (STAFF)** существует связь 1:М, обязательная с двух сторон. Компания обязательно имеет в штате хотя одного сотрудника. Каждый сотрудников обязательно работает в компании. 

Ключевым атрибутом сущности **Сотрудник (STAFF)** является Номер сотрудника (Staff\_no). Ключевым атрибутом сущности **Компания (COMPANY)** является УНП (*Company\_no*).

**2. Компания и Автомобиль**

Из описания предметной области известно, что каждый автомобиль, предлагаемый для принадлежит компании. В компании есть сотрудники, отвечающие за оформление договоров аренды и актов приема-передачи с предлагаемыми для аренды автомобилями. Для отражения этой ситуации необходимо провести связь между сущностями **Автомобиль** и **Компания**. Для того чтобы узнать, какой Автомобиль обслуживается каким сотрудником и, с другой стороны, какой сотрудник отвечает за данный автомобиль вводится дополнительная связь между сущностями Автомобиль и Сотрудник. 

Между сущностями **Компания** и **Автомобиль** установлена связь 1:М, обязательная с 2-х сторон. Компании может принадлежат множество разных автомобилей, но все автомобили будут принадлежат одной компании.

Ключевым атрибутом сущности **Автомобиль (AUTO)** является Регистрационный номер *(Reg\_no*)). Ключевым атрибутом сущности **Компания (COMPANY)** является УНП (*Company\_no*).

**3. Компания и Клиент** 

Между сущностями Компания и Клиент существует связь 1:М, необязательная с стороны Компании . Компания необязательно имеет отношения с клиентами (например, при наличии ранее штрафа у клиента, при создании, перед процедурой ликвидации, либо все договоры с клиентами исполнены и другие обстоятельства). Каждый клиент обязательно должен обратиться в компанию для аренды автомобиля. 

Ключевым атрибутом сущности **Компания (COMPANY)** является УНП (*Company\_no*). Ключевым атрибутом сущности **Клиент (CUSTOMER**) является Номер клиента (*Customer\_no*).

**4. Клиент и Договор аренды**

Между сущностями **Клиент и Договор аренды** – связь 1:М, обязательная с 2-х сторон, поскольку при оформлении договорных отношений по аренде автомобиля, обязательно должен быть заключен договор в письменной форме, и обязательным является наличие указание в договоре его сторон, в том числе клиента.

Клиент может заключить несколько договоров аренды автомобилей, но все заключенные договоры будут исполняться одним клиентом.

Ключевым атрибутом сущности **Клиент (CUSTOMER**) является Номер клиента (*Customer\_no*). Ключевым атрибутом сущности **Договор аренды (RENTAL\_CONTRACT**) является Номер договора (*RContract\_no*).

**5. Договор аренды и Автомобиль**

Каждый договор аренды должен содержать указание на предмет договора. Применительно к описываемой предметной области предметом договора аренды является предоставление клиенту автомобиля. В связи с этим необходимо установить связь между сущностями **Автомобиль (AUTO)** и **Договор аренды (RENTAL\_CONTRACT)**. 

Между сущностями Договор аренды и Автомобиль установлена связь 1:М, обязательная с 2-х сторон. Договор аренды может быть заключен в отношении множества разных автомобилей, но все автомобили будут перечислены в одном договоре аренды.

Ключевым атрибутом сущности **Договор аренды (RENTAL\_CONTRACT**) является Номер договора (*RContract\_no*). Ключевым атрибутом сущности **Автомобиль (AUTO)** является Код авто (*Code\_auto*).

**6. Договор аренды и Акт приема-передачи**

После заключения договора аренды и проведения осмотра выбранного автомобиля, в случае отсутствия замечаний к техническому состоянию автомобиля со стороны Клиента, подписывается акт приема-передачи. Акт приема-передачи заполняется на основании сведений, содержащихся в Договоре аренды. Актов приема-передачи по одному договору может быть несколько, в том случае, если арендуется несколько автомобилей. 

Между сущностями Договор аренды и Акт приема-передачи установлена связь 1:М, обязательная с 2-х сторон. Договор аренды может являться основанием для составления множества актов приема-передачи, но все акты приема передачи будут относиться к конкретному договору.

Ключевым атрибутом сущности **Договор аренды (RENTAL\_CONTRACT**) является Номер договора (*RContract\_no*). Ключевым атрибутом сущности **Акт приема-передачи (ACCEPTANCE\_CERTIFICATE)** является Номер акта (*ACertificate\_no*).

**7. Сотрудник и Акт приема-передачи**

Между сущностями **Сотрудник** и **Акт приема-передачи** – связь M:М, обязательная с 2-х сторон, поскольку после оформления договорных отношений по аренде автомобиля, обязательно должен быть оформлен акт приема-передачи в письменной форме в котором обязательно необходимо наличие указать в акте приема-передачи лиц, подписывающих его: Сотрудники со стороны компании и Клиент.

Актов приема-передачи по одному договору может быть несколько, в том случае, если арендуется несколько автомобилей. 

Сотрудников со стороны компании, подписывающих акт приема-передачи также может быть несколько, поскольку акт подписывает сотрудник – агент по аренде и сотрудник-механик. Сотрудник – агент по аренде, расписывается как правомочное лицо на заключение и подписание по доверенности от стороны компании договора и всех документов к нему, в том числе акта приема-передачи, а сотрудник-механик расписывается в акте о том, что автомобиль на момент передачи клиенту (возврата клиентом) находится в исправном состоянии.

Ключевым атрибутом сущности **Сотрудник (STAFF)** (сотрудник – агент по аренде, сотрудник-механик) является Номер сотрудника (*Staff\_no*). Ключевым атрибутом сущности **Акт приема-передачи (ACCEPTANCE\_CERTIFICATE)** является Номер акта (*ACertificate\_no*).




**Инфологическая модель предметной области**

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.001.png)

**Переход к реляционной модели**

В реляционной модели связи явным образом не отображаются, однако между отношениями поддерживаются иерархические связи (в каждой связи одно отношение выступает как основное, а другое как подчиненное). Это значит, что один кортеж основного отношения может быть связан с несколькими кортежами подчиненного отношения. Для поддержки этих связей оба отношения должны содержать наборы атрибутов, по которым они связаны. В основном отношении это первичный ключ отношения. В подчиненном отношении для моделирования связи должен присутствовать набор атрибутов, соответствующий первичному ключу основного отношения. Данный набор атрибутов в подчиненном отношении принято называть внешним ключом. Согласно правилу 4 перехода к реляционной модели (в каждое отношение, соответствующее подчиненной сущности, добавляется набор атрибутов основной сущности, являющейся ее первичным ключом), введем в дополнительное отношение **Осмотр (VIEWING)** ключи отношений **Договор аренды (RENTAL\_CONTRACT**), **Сотрудник (STAFF), Акт приема-передачи (ACCEPTANCE\_CERTIFICATE)**.

Для связи М:М между сущностями **Договор аренды (RENTAL\_CONTRACT**) и **Акт приема-передачи Акт приема-передачи (ACCEPTANCE\_CERTIFICATE)** для отражения сведений о результатах осмотра перед передачей автомобиля введено дополнительное связующее отношение, которое связано с каждым исходным связью 1:М. 

Атрибутами этого связующего отношения, будут являться следящие: номер осмотра (Viewing\_no), дата осмотра (Date\_View), комментарии (Comments), а также первичные ключи связываемых отношений: номер клиента (Customer\_no), номер договора (RContract\_no), код авто (Code\_auto), номер сотрудника – агента по аренде (Staff\_no), номер сотрудника-механика (Staff\_no), результаты (Result\_viewing)

Для нового отношения они являются внешними ключами, а вместе они образуют первичный ключ новой связующей сущности **Осмотр (VIEWING)**.


|**ОСМОТР (VIEWING)**|
| :-: |
|<p>Номер осмотра (**Viewing\_no**)</p><p>Дата осмотра (**Date\_View**) </p><p>Комментарии (**Comments**) </p><p>Номер клиента **(Customer\_no)**</p><p>Номер договора **(RContract\_no)**</p><p>Код авто **(Code\_auto)**</p><p>Номер сотрудника – агента по аренде **(Staff\_no)**</p><p>Номер сотрудника-механика **(Staff\_no)**</p><p>Результаты **(Result\_viewing)**</p>|




![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.002.png)**Реляционная модель**

**Создание базы данных.**

Создание базы данных **Rent\_a\_Car** в PastgreSQL

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.003.png)

Код создания:

CREATE DATABASE "Rent\_a\_Car"

`    `WITH

`    `OWNER = postgres

`    `ENCODING = 'UTF8'

`    `CONNECTION LIMIT = -1

`    `IS\_TEMPLATE = False;

Результат создания базы данных в СУБД:

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.004.png)

**Создание отношений.**

Код для СУБД PostgreSQL:

-- Создание таблицы СОТРУДНИК

CREATE TABLE STAFF (

`    `Staff\_no SERIAL PRIMARY KEY,

`    `FName VARCHAR(50) NOT NULL,

`    `LName VARCHAR(50) NOT NULL,

`    `SName VARCHAR(50),

`    `DOB DATE,

`    `Sex VARCHAR(10) CHECK (Sex IN ('Мужской', 'Женский', 'Иное')),

`    `City VARCHAR(50),

`    `Street VARCHAR(50),

`    `House VARCHAR(10),

`    `Flat VARCHAR(10),

`    `Stel\_no VARCHAR(20) CHECK (Stel\_no ~ '^\+(375(17|29|33|25|44))\d{7}$'),

`    `ID\_Pass VARCHAR(14) CHECK (ID\_Pass ~ '^\d{7}[A-Z0-9]{1}\d{3}[A-Z0-9]{1}\d{2}$') NOT NULL UNIQUE,

`    `Date\_of\_Issue DATE,

`    `Validity DATE,

`    `Pass\_series VARCHAR(10),

`    `Pass\_no VARCHAR(20),

`    `Gov\_no VARCHAR(20),

`    `Government VARCHAR(50),

`    `Date\_Joined DATE,

`    `Position VARCHAR(50),

`    `Salary NUMERIC(10, 2)

);

-- Создание таблицы АВТОМОБИЛЬ

CREATE TABLE AUTO (

`    `Code\_auto SERIAL PRIMARY KEY,

`    `Code\_mark INT,

`    `NCar VARCHAR(50),

`    `Engine VARCHAR(255),

`    `Transmission VARCHAR(50) CHECK (Transmission IN ('Механическая', 'Автомат', 'Робот', 'Иное')),

`    `Сapacity NUMERIC(5, 2),

`    `Fuel\_consumption NUMERIC(5, 2),

`    `Car\_text TEXT,

`    `Code\_car VARCHAR(20) UNIQUE,

`    `Reg\_no VARCHAR(20) CHECK (Reg\_no ~ '^[А-Я]{1}\d{3}\s[А-Я]{2}\s\d{3}$') UNIQUE,

`    `Car\_body\_no VARCHAR(20),

`    `Engine\_no VARCHAR(20),

`    `IYear INT,

`    `Mileage INT,

`    `Car\_price NUMERIC(10, 2),

`    `Rental\_price NUMERIC(10, 2),

`    `Date\_maintenance DATE

);

-- Создание таблицы КОМПАНИЯ

CREATE TABLE COMPANY (

`    `Company\_no VARCHAR(9) CHECK (Company\_no ~ '^\d{9}$') PRIMARY KEY,

`    `Postcode VARCHAR(6) CHECK (Postcode ~ '^\d{6}$'),

`    `Street VARCHAR(50),

`    `City VARCHAR(50),

`    `House VARCHAR(10),

`    `Btel\_no VARCHAR(20) CHECK (Btel\_no ~ '^\+(375(17|29|33|25|44))\d{7}$'),

`    `Fax\_no VARCHAR(20)

);

-- Создание таблицы КЛИЕНТ

CREATE TABLE CUSTOMER (

`    `Customer\_no SERIAL PRIMARY KEY,

`    `Age INT DEFAULT 18 CHECK (Age >= 18),

`    `Pass\_data VARCHAR(255),

`    `FName VARCHAR(50) NOT NULL,

`    `LName VARCHAR(50) NOT NULL,

`    `Branch\_no INT,

`    `SName VARCHAR(50),

`    `City VARCHAR(50),

`    `Street VARCHAR(50),

`    `ID\_Pass VARCHAR(14) CHECK (ID\_Pass ~ '^\d{7}[A-Z0-9]{1}\d{3}[A-Z0-9]{1}\d{2}$') NOT NULL UNIQUE,

`    `Date\_of\_Issue DATE,

`    `Validity DATE,

`    `Pass\_series VARCHAR(10),

`    `Pass\_no VARCHAR(20),

`    `Gov\_no VARCHAR(20),

`    `Government VARCHAR(50),

`    `House VARCHAR(10),

`    `Flat VARCHAR(10),

`    `Tell\_no VARCHAR(20) CHECK (Tell\_no ~ '^\+(375(17|29|33|25|44))\d{7}$'),

`    `Regular\_customer BOOLEAN DEFAULT FALSE,

`    `Fine BOOLEAN DEFAULT FALSE

);

-- Создание таблицы ДОГОВОР АРЕНДЫ

CREATE TABLE RENTAL\_CONTRACT (

`    `RContract\_no SERIAL PRIMARY KEY,

`    `Date\_contact DATE NOT NULL,

`    `Subject\_contact VARCHAR(50) NOT NULL,

`    `Code\_auto INT,

`    `Company\_no VARCHAR(20),

`    `Customer\_no INT,

`    `Rental\_price NUMERIC(10, 2) NOT NULL,

`    `CONSTRAINT rental\_contract\_fk\_auto FOREIGN KEY (Code\_auto) REFERENCES AUTO(Code\_auto) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT rental\_contract\_fk\_company FOREIGN KEY (Company\_no) REFERENCES COMPANY(Company\_no) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT rental\_contract\_fk\_customer FOREIGN KEY (Customer\_no) REFERENCES CUSTOMER(Customer\_no) ON DELETE CASCADE ON UPDATE CASCADE

);

-- Создание таблицы АКТ ПРИЕМА-ПЕРЕДАЧИ

CREATE TABLE ACCEPTANCE\_CERTIFICATE (

`    `ACertificate\_no SERIAL PRIMARY KEY,

`    `Staff\_no INT,

`    `Date\_a\_cettificate DATE NOT NULL,

`    `Code\_auto INT,

`    `Rental\_price NUMERIC(10, 2) NOT NULL,

`    `Code\_mechanic INT,

`    `Spec\_marks VARCHAR(255),

`    `Return\_stamp BOOLEAN,

`    `Cade\_client INT,

`    `Date\_of\_issue DATE,

`    `Time\_of\_issue TIME,

`    `Return\_date DATE,

`    `Return\_time TIME,

`    `Rental\_hours INT,

`    `Overdue\_hours INT,

`    `Fine\_amount NUMERIC(10, 2),

`    `CONSTRAINT acceptance\_certificate\_fk\_staff FOREIGN KEY (Staff\_no) REFERENCES STAFF(Staff\_no) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT acceptance\_certificate\_fk\_auto FOREIGN KEY (Code\_auto) REFERENCES AUTO(Code\_auto) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT acceptance\_certificate\_fk\_mechanic FOREIGN KEY (Code\_mechanic) REFERENCES STAFF(Staff\_no) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT acceptance\_certificate\_fk\_customer FOREIGN KEY (Cade\_client) REFERENCES CUSTOMER(Customer\_no) ON DELETE CASCADE ON UPDATE CASCADE

);

-- Создание таблицы ОСМОТР

CREATE TABLE VIEWING (

`    `Viewing\_no SERIAL PRIMARY KEY,

`    `RContract\_no INT,

`    `Date\_View DATE,

`    `Comments TEXT,

`    `Customer\_no INT,

`    `Code\_auto INT,

`    `Staff\_no\_agent INT,

`    `Staff\_no\_mechanic INT,

`    `Result\_viewing VARCHAR(255),

`    `CONSTRAINT viewing\_fk\_rental\_contract FOREIGN KEY (RContract\_no) REFERENCES RENTAL\_CONTRACT(RContract\_no) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT viewing\_fk\_customer FOREIGN KEY (Customer\_no) REFERENCES CUSTOMER(Customer\_no) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT viewing\_fk\_auto FOREIGN KEY (Code\_auto) REFERENCES AUTO(Code\_auto) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT viewing\_fk\_agent FOREIGN KEY (Staff\_no\_agent) REFERENCES STAFF(Staff\_no) ON DELETE CASCADE ON UPDATE CASCADE,

`    `CONSTRAINT viewing\_fk\_mechanic FOREIGN KEY (Staff\_no\_mechanic) REFERENCES STAFF(Staff\_no) ON DELETE CASCADE ON UPDATE CASCADE

);


Результат выполнения запроса:

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.005.png)

Пример запроса для заполнения <a name="_hlk152507793"></a>полей отношения **STAFF**:


-- Заполнение таблицы <a name="_hlk152506992"></a>STAFF

INSERT INTO STAFF (FName, LName, SName, DOB, Sex, City, Street, House, Flat, Stel\_no, ID\_Pass, Date\_of\_Issue, Validity, Pass\_series, Pass\_no, Gov\_no, Government, Date\_Joined, Position, Salary)

VALUES

`    `('Алексей', 'Сидоров', 'Петрович', '1988-03-20', 'Мужской', 'Город3', 'Улица3', '3', '3', '+375291234569', '2345681B001C21', '2022-03-01', '2023-03-01', 'DE', '345678', '9012345', 'Орган3', '2022-03-20', 'Должность3', 5500.00),

`    `('Наталья', 'Ковалева', 'Игоревна', '1992-04-25', 'Женский', 'Город4', 'Улица4', '4', '4', '+375291234570', '2345681B001C22', '2022-04-01', '2023-04-01', 'EF', '456789', '0123456', 'Орган4', '2022-04-25', 'Должность4', 6500.00),

`    `('Андрей', 'Васнецов', 'Иванович', '1980-05-10', 'Мужской', 'Город5', 'Улица5', '5', '5', '+375291234571', '1445681B001C23', '2022-05-01', '2023-05-01', 'FG', '567890', '1234567', 'Орган5', '2022-05-10', 'Должность5', 7000.00),

`    `('Юлия', 'Семенова', 'Александровна', '1986-06-15', 'Женский', 'Город6', 'Улица6', '6', '6', '+375291234572', '1345681B001C24', '2022-06-01', '2023-06-01', 'GH', '678901', '2345678', 'Орган6', '2022-06-15', 'Должность6', 7500.00),

`    `('Владимир', 'Тарасов', 'Николаевич', '1982-07-20', 'Мужской', 'Город7', 'Улица7', '7', '7', '+375291234573', '2345681B001C25', '2022-07-01', '2023-07-01', 'HI', '789012', '3456789', 'Орган7', '2022-07-20', 'Должность7', 8000.00),

`    `('Ольга', 'Павлова', 'Дмитриевна', '1994-08-25', 'Женский', 'Город8', 'Улица8', '8', '8', '+375291234574', '1245681B001C26', '2022-08-01', '2023-08-01', 'IJ', '890123', '4567890', 'Орган8', '2022-08-25', 'Должность8', 8500.00),

`    `('Сергей', 'Кузнецов', 'Игнатьевич', '1983-09-30', 'Мужской', 'Город9', 'Улица9', '9', '9', '+375291234575', '2345681B001C27', '2022-09-01', '2023-09-01', 'JK', '901234', '5678901', 'Орган9', '2022-09-30', 'Должность9', 9000.00),

`    `('Татьяна', 'Григорьева', 'Сергеевна', '1987-10-05', 'Женский', 'Город10', 'Улица10', '10', '10', '+375291234576', '2345681B001C28', '2022-10-01', '2023-10-01', 'KL', '012345', '6789012', 'Орган10', '2022-10-05', 'Должность10', 9500.00);


Результат выполнения запроса заполнения полей отношения **STAFF**: 

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.006.png)



**

**Запросы.**

**1. Информация о клиенте и его договорах аренды:** получить все договоры аренды для определенного клиента, включая данные клиента.

SELECT \*

FROM CUSTOMER

JOIN RENTAL\_CONTRACT ON CUSTOMER.Customer\_no = RENTAL\_CONTRACT.Customer\_no

WHERE CUSTOMER.Customer\_no = 1;

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.007.png)

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.008.png)

**2. Информация о прокате автомобилей:** получить информацию о клиенте, автомобиле и договоре аренды, чтобы узнать, кто арендовал какой автомобиль.

SELECT CUSTOMER.FName, CUSTOMER.LName, AUTO.NCar, RENTAL\_CONTRACT.Date\_contact

FROM RENTAL\_CONTRACT

JOIN CUSTOMER ON RENTAL\_CONTRACT.Customer\_no = CUSTOMER.Customer\_no

JOIN AUTO ON RENTAL\_CONTRACT.Code\_auto = AUTO.Code\_auto;

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.009.png)

**3. Информация о действующих договорах аренды:** получить информацию о действующих договорах аренды, включая клиента и автомобиль.

SELECT CUSTOMER.FName, CUSTOMER.LName, AUTO.NCar, RENTAL\_CONTRACT.Date\_contact

FROM RENTAL\_CONTRACT

JOIN CUSTOMER ON RENTAL\_CONTRACT.Customer\_no = CUSTOMER.Customer\_no

JOIN AUTO ON RENTAL\_CONTRACT.Code\_auto = AUTO.Code\_auto

WHERE RENTAL\_CONTRACT.Date\_contact <= CURRENT\_DATE

`  `AND RENTAL\_CONTRACT.Rental\_price IS NOT NULL;

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.010.png)

**4. Группировка и фильтрация данных:** сумма пробега по каждому типу автомобиля, но только для тех автомобилей, пробег которых больше 10000.

SELECT AUTO.Code\_mark, SUM(AUTO.Mileage) AS TotalMileage

FROM AUTO

WHERE AUTO.Mileage > 10000

GROUP BY AUTO.Code\_mark;

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.011.png)

**5. Группировка с использованием ROLLUP:** сумма пробега по каждому типу автомобиля, а также общую сумму пробега для всех автомобилей.

SELECT AUTO.Code\_mark, SUM(AUTO.Mileage) AS TotalMileage

FROM AUTO

GROUP BY ROLLUP(AUTO.Code\_mark);

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.012.png)

**6. Группировка с использованием GROUPING SETS:** вывести сумму пробега по каждому типу автомобиля и общую сумму пробега для всех автомобилей, используя GROUPING SETS.

SELECT AUTO.Code\_mark, SUM(AUTO.Mileage) AS TotalMileage

FROM AUTO

GROUP BY GROUPING SETS (AUTO.Code\_mark, ());

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.013.png)

**7. Использование HAVING:** вывести только те марки автомобилей, у которых средний расход топлива выше 8.

SELECT AUTO.Code\_mark, AVG(AUTO.Fuel\_consumption) AS AvgFuelConsumption

FROM AUTO

GROUP BY AUTO.Code\_mark

HAVING AVG(AUTO.Fuel\_consumption) > 8;

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.014.png)

**8. Использование WINDOW FUNCTIONS с OVER:** вывести среднюю зарплату для каждого сотрудника, а также общую среднюю зарплату по всем сотрудникам.

SELECT Staff\_no, Salary, AVG(Salary) OVER () AS OverallAvgSalary

FROM STAFF;

![](Aspose.Words.ef6dcae0-82a0-4056-a57d-9e5c85f89760.015.png)


